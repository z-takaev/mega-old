var wcffEditorObj=null,wcffValidatorObj=null,wcffFieldsRulerObj=null,wcffPricingRulerObj=null;!function($){var a=null,b=!0,c=null,d=null;Array.prototype.equals=function(b){if(!b||this.length!=b.length)return!1;for(var a=0,c=this.length;a<c;a++)if(this[a]instanceof Array&&b[a]instanceof Array){if(!this[a].equals(b[a]))return!1}else if(this[a]!=b[a])return!1;return!0},Object.defineProperty(Array.prototype,"equals",{enumerable:!1}),Number.prototype.formatMoney=function(a,b,d){var e=this,a=isNaN(a=Math.abs(a))?2:a,d=void 0==d?".":d,b=void 0==b?",":b,f=parseInt(e=Math.abs(+e||0).toFixed(a))+"",c=(c=f.length)>3?c%3:0;return(e<0?"-":"")+(c?f.substr(0,c)+b:"")+f.substr(c).replace(/(\d{3})(?=\d)/g,"$1"+b)+(a?d+Math.abs(e-f).toFixed(a).slice(2):"")};var e=function(){this.init=function(){$(document).on("change","[data-has_field_rules=yes]",this,function(a){a.data.handleFieldChangeEvent($(this))}),$("[data-has_field_rules=yes]").trigger("change")},this.handleFieldChangeEvent=function(h){var a=0,e=0,m=this,k="",d="",i=[],l=!1,f="",j=[],b=h.attr("data-fkey"),g=h.attr("data-field-type"),c=h.closest("div.wcff-fields-group");if(c.attr("data-custom-layout"),"radio"==g?d=h.closest("ul").find("input[type=radio]:checked").val():"checkbox"==g?d=h.closest("ul").find("input[type=checkbox]:checked").map(function(){return m.escapeQuote(this.value)}).get():"datepicker"==g?(day=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],f=h.datepicker("getDate")):("text"==g||"number"==g||"select"==g||"textarea"==g||"colorpicker"==g)&&(d=h.val()),wcff_fields_rules_meta[b])for(a=0;a<wcff_fields_rules_meta[b].length;a++)if("equal"==wcff_fields_rules_meta[b][a].logic&&wcff_fields_rules_meta[b][a].expected_value==d)this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules);else if("not-equal"==wcff_fields_rules_meta[b][a].logic&&wcff_fields_rules_meta[b][a].expected_value!=d)this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules);else if("greater-than-equal"==wcff_fields_rules_meta[b][a].logic&&wcff_fields_rules_meta[b][a].expected_value<=d)this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules);else if("greater-than"==wcff_fields_rules_meta[b][a].logic&&wcff_fields_rules_meta[b][a].expected_value<d)this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules);else if("less-than-equal"==wcff_fields_rules_meta[b][a].logic&&wcff_fields_rules_meta[b][a].expected_value>=d)this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules);else if("less-than"==wcff_fields_rules_meta[b][a].logic&&wcff_fields_rules_meta[b][a].expected_value>d)this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules);else if("is-only"==wcff_fields_rules_meta[b][a].logic&&wcff_fields_rules_meta[b][a].expected_value.equals(d))this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules);else if("is-also"==wcff_fields_rules_meta[b][a].logic&&wcff_fields_rules_meta[b][a].expected_value.some(a=>d.includes(a)))this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules);else if("any-one-of"==wcff_fields_rules_meta[b][a].logic){var j=this.fetchCommonItems(wcff_fields_rules_meta[b][a].expected_value,d);if(j.length<=wcff_fields_rules_meta[b][a].expected_value.length){for(e=0,l=!0;e<j.length;e++)-1===wcff_fields_rules_meta[b][a].expected_value.indexOf(j[e])&&(l=!1);l&&this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules)}}else if("has-options"==wcff_fields_rules_meta[b][a].logic&&wcff_fields_rules_meta[b][a].expected_value.some(a=>d.includes(a)))this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules);else if("has-not-options"!=wcff_fields_rules_meta[b][a].logic||wcff_fields_rules_meta[b][a].expected_value.some(a=>d.includes(a))){if("days"==wcff_fields_rules_meta[b][a].logic&&Array.isArray(wcff_fields_rules_meta[b][a].expected_value))-1!=wcff_fields_rules_meta[b][a].expected_value.indexOf(f.getDay())&&this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules);else if("specific-dates"==wcff_fields_rules_meta[b][a].logic&&""!=wcff_fields_rules_meta[b][a].expected_value)for(e=0,i=wcff_fields_rules_meta[b][a].expected_value.split(",");e<i.length;e++)parseInt((k=i[e].trim().split("-"))[0].trim())==f.getMonth()+1&&parseInt(k[1].trim())==f.getDate()&&parseInt(k[2].trim())==f.getFullYear()&&this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules);else if("weekends-weekdays"==wcff_fields_rules_meta[b][a].logic)"weekends"==wcff_fields_rules_meta[b][a].expected_value?(6==f.getDay()||0==f.getDay())&&this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules):(6!=f.getDay()||0!=f.getDay())&&this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules);else if("specific-dates-each-month"==wcff_fields_rules_meta[b][a].logic)for(e=0,i=wcff_fields_rules_meta[b][a].expected_value.split(",");e<i.length;e++)parseInt(i[e].trim())==f.getDay()&&this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules);else"not-null"==wcff_fields_rules_meta[b][a].logic&&d?this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules):"null"==wcff_fields_rules_meta[b][a].logic&&(""===d||null==d)&&this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules)}else this.handleFieldsVisibility(c,wcff_fields_rules_meta[b][a].field_rules)},this.handleFieldsVisibility=function(a,b){var c=null,d=a.attr("data-custom-layout");a.find(".wccpf-field ").each(function(){c="yes"==d?$(this).closest("div.wcff-layout-form-col"):$(this).parent().hasClass("wcff-label")?$(this).parent():$(this).closest("table.wccpf_fields_table"),b[$(this).attr("data-fkey")]&&("show"==b[$(this).attr("data-fkey")]?(c.show(),c.removeClass("wcff_is_hidden_from_field_rule")):"hide"==b[$(this).attr("data-fkey")]&&(c.hide(),c.addClass("wcff_is_hidden_from_field_rule")))})},this.fetchCommonItems=function(a,b){return $.grep(a,function(a){return -1!==$.inArray(a,b)})},this.escapeQuote=function(a){return a&&(a=(a=a.replace(/'/g,"&#39;")).replace(/"/g,"&#34;")),a},this.unEscapeQuote=function(a){return a&&(a=(a=a.replace(/&#39;/g,"'")).replace(/&#34;/g,'"')),a}},f=function(){this.init=function(){$(document).on("change","input[name=quantity]",this,function(i){var d=parseInt($(this).val()),e=parseInt($("#wccpf_fields_clone_count").val());if($("#wccpf_fields_clone_count").val(d),e<d){var f=0,b=0,g=0,l=i.data,a=null,h=null,c=null,m=!1;for(b=0,c=$(".wccpf-fields-group-container");b<c.length;b++)if((h=$(c[b]).find("> div:not(.cloned)"))&&h.length>0){if("no"==h.attr("data-group-clonable"))continue;for(a=null,f=e;f<d;f++)(a=h.clone(!0)).addClass("cloned"),a.find("script").remove(),a.find("div.sp-replacer").remove(),a.find("span.wccpf-fields-group-title-index").html(f+1),a.find(".hasDatepicker").attr("id",""),a.find(".hasDatepicker").removeClass("hasDatepicker"),a.find(".wccpf-field").each(function(){$(this).hasClass("label")||(l.updateFieldIndex(f,$(this)),"checkbox"==$(this).attr("data-field-type")||"radio"==$(this).attr("data-field-type")?$(this).prop("checked",!1):$(this).val(""))}),a.find(".wccaf-field").each(function(){$(this).hasClass("label")||(l.updateFieldIndex(f,$(this)),"checkbox"==$(this).attr("data-field-type")||"radio"==$(this).attr("data-field-type")?$(this).prop("checked",!1):$(this).val(""))}),a.find(".wccvf-field").each(function(){$(this).hasClass("label")||(l.updateFieldIndex(f,$(this)),"checkbox"==$(this).attr("data-field-type")||"radio"==$(this).attr("data-field-type")?$(this).prop("checked",!1):$(this).val(""))}),a.find(".wcff-label").each(function(){m=$(this).attr("data-cloneable");var a=$(this).find("input").attr("name").slice(0,-1)+f;$(this).find("input").attr("name",a),(void 0===m|| !1===m)&&$(this).remove()}),a.find("div[class=wcff-layout-form-col]:not(:has(*))").remove(),a.find("div[class=wcff-layout-form-row]:not(:has(*))").remove(),$(c[b]).append(a),setTimeout(function(){k()},500)}}else{var j=e-d;for(b=0,c=$(".wccpf-fields-group-container");b<c.length;b++)for($(c[b]).find("> div"),g=0;g<j;g++)c.find("> div:nth-child("+(e-g)+")").remove()}}),setTimeout(function(){$("input[name=quantity]").trigger("change")},300)},this.updateFieldIndex=function(d,a){var c=a.attr("data-cloneable");if(("checkbox"===a.attr("data-field-type")||"radio"===a.attr("data-field-type"))&&(c=a.closest("ul").attr("data-cloneable")),void 0===c&&(c="yes"),"no"!==c){var b=a.attr("name");b=-1!=b.indexOf("[]")?b.substring(0,b.lastIndexOf("_"))+"_"+(d+1)+"[]":b.slice(0,-1)+(d+1),a.attr("name",b)}else a.closest("table.wccpf_fields_table").remove()}},g=function(){this.isValid=!0,this.init=function(){$(document).on("submit","form.cart",this,function(a){var b=a.data;return a.data.isValid=!0,$(this).find(".wccpf-field").each(function(){"yes"===$(this).attr("data-mandatory")&&b.doValidate($(this))}),a.data.isValid}),"blur"===wccpf_opt.validation_type&&$(document).on("blur",".wccpf-field",this,function(a){"yes"===$(this).attr("data-mandatory")&&a.data.doValidate($(this))})},this.doValidate=function(a){return"radio"!==a.attr("data-field-type")&&"checkbox"!==a.attr("data-field-type")&&"file"!==a.attr("data-field-type")?"select"!==a.attr("data-field-type")?this.doPatterns(a.attr("data-pattern"),a.val())?a.nextAll(".wccpf-validation-message").hide():(this.isValid=!1,a.nextAll(".wccpf-validation-message").css("display","block")):""!==a.val()&&"wccpf_none"!==a.val()?a.nextAll(".wccpf-validation-message").hide():(this.isValid=!1,a.nextAll(".wccpf-validation-message").css("display","block")):"radio"===a.attr("data-field-type")?a.closest("td.wccpf_value").find("input[type=radio]").is(":checked")?a.closest("td.wccpf_value").find("span.wccpf-validation-message").hide():(a.closest("td.wccpf_value").find("span.wccpf-validation-message").css("display","block"),this.isValid=!1):"checkbox"===a.attr("data-field-type")?0===a.closest("td.wccpf_value").find("input[type=checkbox]:checked").map(function(){return this.value}).get().length?(a.closest("td.wccpf_value").find("span.wccpf-validation-message").css("display","block"),this.isValid=!1):a.closest("td.wccpf_value").find("span.wccpf-validation-message").hide():"file"===a.attr("data-field-type")&&(""==a.val()?(a.next().css("display","block"),this.isValid=!1):a.next().hide()),this.isValid},this.doPatterns=function(a,c){var b={mandatory:/\S/,number:/^-?\d+\.?\d*$/,email:/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i};return!a||!b[a]||b[a].test(c)}},h=function(){this.top=0,this.left=0,this.bottom=0,this.right=0,this.target=null,this.mask=null,this.getPosition=function(c){this.target=c;var a=this.target.position(),b=this.target.offset();this.top=b.top,this.left=b.left,this.bottom=$(window).width()-a.left-this.target.width(),this.right=$(window).height()-a.right-this.target.height()},this.doMask=function(a){a&&(this.target=a,this.mask=$('<div class="wcff-dock-loader"></div>'),this.target.append(this.mask),this.mask.css("left","0px"),this.mask.css("top","0px"),this.mask.css("right",this.target.innerWidth()+"px"),this.mask.css("bottom",this.target.innerHeight()+"px"),this.mask.css("width",this.target.innerWidth()+"px"),this.mask.css("height",this.target.innerHeight()+"px"))},this.doUnMask=function(){this.mask&&this.mask.remove()}},i=function(){this.appliedRules={},this.init=function(){this.registerEvents()},this.registerEvents=function(){$(document).on("change","[data-has_pricing_rules=yes]",this,function(a){a.data.updatePrice($(this)),a.data.refreshPricingRuleTitles($(this))})},this.refreshPricingRuleTitles=function(a){var b=this,c=[],d=[],e="",f=[],g=null;void 0!==a?a.closest("div.wcff-fields-group"):$("div.wccpf-fields-container"),$("div.wcff-fields-group").each(function(){if(e="",d=$(this).find('[data-has_pricing_rules="yes"]'),f=b.getFieldsPricingRules(d),Array.isArray(f)&&f.length>0){for(let h=0;h<f.length;h++)if(wcff_pricing_rules_meta&&wcff_pricing_rules_meta[f[h].fkey]){c=wcff_pricing_rules_meta[f[h].fkey];for(let a=0;a<c.length;a++)b.checkPricingRules(c[a],f[h].fval,f[h].ftype,f[h].dformat)&&("cost"==c[a].tprice?e+=c[a].title+" : "+wccpf_opt.currency+c[a].amount+"<br/>":e+=c[a].title+" : "+c[a].amount+"%<br/>")}}"show"==wccpf_opt.price_details&&""!=e?0==(g=$(this).find(".wcff_pricing_rules_title_container")).length?$(this).append('<div class="wcff_pricing_rules_title_container">'+e+"</div>"):(g.html(e),g.show()):$(this).find(".wcff_pricing_rules_title_container").hide()})},this.updatePrice=function(b){var c=[],a=[];c="archive"==wccpf_opt.is_page?b.closest("li.product").find("[data-is_pricing_rules=yes]"):$('[data-has_pricing_rules="yes"]'),a=this.getFieldsPricingRules(c),Array.isArray(a)&&a.length>0&&this.determineThePrice(a,b)},this.getFieldsPricingRules=function(d){var e="",b="",f=[],a=null;for(let c=0;c<d.length;c++)((a=$(d[c])).is(":visible")||a.is(".wccpf-color")&&a.closest("table").is(":visible")&&!a.closest("table").is(".wcff_is_hidden_from_field_rule"))&&(e=a.attr("data-fkey"),a.is("[type=checkbox]")?(b=[],a.is(":checked")&&(b=[a.val()])):a.is("[type=radio]")?(b="",a.is(":checked")&&(b=a.val())):b=a.val(),f.push({fkey:e,fval:b,ftype:a.attr("data-field-type"),dformat:a.attr("data-date-format")}));return f},this.determineThePrice=function(e,l){var c,a,b,f,k=[],g="",h=[],d=0,i=0,j=0;if("yes"==wcff_is_variable){if(""==$("input[name=variation_id]").val())return;for(c=0,h=$("form.variations_form").attr("data-product_variations"),h=JSON.parse(h),k=Object.keys(h);c<k.length;c++)h[k[c]].variation_id==$("input[name=variation_id]").val()&&(d=h[k[c]].display_regular_price)}else d=wcff_product_price;for(c=0;c<e.length;c++)if(wcff_pricing_rules_meta&&wcff_pricing_rules_meta[e[c].fkey])for(a=0,b=wcff_pricing_rules_meta[e[c].fkey];a<b.length;a++)this.checkPricingRules(b[a],e[c].fval,e[c].ftype,e[c].dformat)&&("cost"==b[a].tprice?"add"==b[a].ptype?i+=parseFloat(b[a].amount):"sub"==b[a].ptype?i-=parseFloat(b[a].amount):j+=parseFloat(b[a].amount):"add"==b[a].ptype?i+=parseFloat(b[a].amount)/100*d:"sub"==b[a].ptype?i-=parseFloat(b[a].amount)/100*d:j+=parseFloat(b[a].amount)/100*d,b[a].title,wccpf_opt.currency,b[a].amount);d=j>0?i+j:d+i+j,"enable"==wccpf_opt.real_time_price_update&&(f=wccpf_opt.number_of_decimal,"yes"==wccpf_opt.trim_zeros&&(f=0),"left"==wccpf_opt.currency_position?g='<bdi><span class="woocommerce-Price-currencySymbol">'+wccpf_opt.currency+"</span>"+d.formatMoney(f,wccpf_opt.thousand_seperator,wccpf_opt.decimal_seperator)+"</bdi>":"right"==wccpf_opt.currency_position?g="<bdi>"+d.formatMoney(f,wccpf_opt.thousand_seperator,wccpf_opt.decimal_seperator)+'<span class="woocommerce-Price-currencySymbol">'+wccpf_opt.currency+"</span></bdi>":"left_space"==wccpf_opt.currency_position?g='<bdi><span class="woocommerce-Price-currencySymbol">'+wccpf_opt.currency+"</span>&nbsp;"+d.formatMoney(f,wccpf_opt.thousand_seperator,wccpf_opt.decimal_seperator)+"</bdi>":"right_space"==wccpf_opt.currency_position&&(g="<bdi>"+d.formatMoney(f,wccpf_opt.thousand_seperator,wccpf_opt.decimal_seperator)+'&nbsp;<span class="woocommerce-Price-currencySymbol">'+wccpf_opt.currency+"</span></bdi>"),"default"==wccpf_opt.price_container_is?("yes"==wcff_is_variable?$("form.variations_form span.amount"):$("div.summary span.amount")).html(g):$(wccpf_opt.price_container).length>0&&$(wccpf_opt.price_container).html('<span class="woocommerce-Price-amount amount">'+g+"</span>"))},this.checkPricingRules=function(a,b,g,f){var c,h,i,e;if(a&&a.expected_value&&a.logic&&""!=b||"datepicker"==g){if("checkbox"!=g&&"datepicker"!=g){if("equal"==a.logic)return a.expected_value==b;if("not-equal"==a.logic)return a.expected_value!=b;if("greater-than"==a.logic)return parseFloat(b)>parseFloat(a.expected_value);if("less-than"==a.logic)return parseFloat(b)<parseFloat(a.expected_value);else if("greater-than-equal"==a.logic)return parseFloat(b)>=parseFloat(a.expected_value);else if("less-than-equal"==a.logic)return parseFloat(b)<=parseFloat(a.expected_value);else if("not-null"==a.logic&&""!=b.trim())return!0}else if("checkbox"==g){if(Array.isArray(a.expected_value)&&Array.isArray(b)&&"has-options"==a.logic){if(!(b.length>=a.expected_value.length))return!1;for(c=0;c<a.expected_value.length;c++)if(-1==b.indexOf(a.expected_value[c]))return!1;return!0}}else if("datepicker"==g){if(""==b)return!1;var j=(f.match(/y/gi)||[]).length;2==j?f=f.replace("yy","yyyy"):1==j&&(f=f.replace("y","yy"));let d=moment(b,f.toUpperCase());if(d&&a.expected_value.dtype&&a.expected_value.value){if("days"==a.expected_value.dtype&&(h=d.format("dddd"),Array.isArray(a.expected_value.value)&& -1!=a.expected_value.value.indexOf(h.toLowerCase())))return!0;if("specific-dates"==a.expected_value.dtype&&(e=a.expected_value.value.split(","),Array.isArray(e))){for(c=0;c<e.length;c++)if(i=moment(e[c].trim(),"M-D-YYYY"),d.format("M-D-YYYY")==i.format("M-D-YYYY"))return!0}if("weekends-weekdays"==a.expected_value.dtype){if("weekends"==a.expected_value.value){if("saturday"==d.format("dddd").toLowerCase()||"sunday"==d.format("dddd").toLowerCase())return!0}else if("saturday"!=d.format("dddd").toLowerCase()&&"sunday"!=d.format("dddd").toLowerCase())return!0}if("specific-dates-each-month"==a.expected_value.dtype){for(c=0,e=a.expected_value.value.split(",");c<e.length;c++)if(e[c].trim()==d.format("D"))return!0}}}}return!1}},j=function(){var b=this;this.init=function(){this.registerEvent()},this.registerEvent=function(){$(document).on("dblclick","li.wcff_cart_editor_field",this,function(b){if(!($("div.wccpf-cart-edit-wrapper").length>0)){var a=$(this);a.closest("ul.wccpf-is-editable-yes").removeClass("wccpf-is-editable-yes"),0!= !a.find("input, select, textarea, label").length&&a.is(".wcff_cart_editor_field")&&b.data.getFieldForEdit(a)}}),$(document).on("click",".wccpf-update-cart-field-btn",this,function(a){a.data.updateField($(this)),a.preventDefault()}),$(document).on("click","#wccpf-cart-editor-close-btn",function(c){var b=$(this).parent();b.closest("ul.wccpf-cart-editor-ul").addClass("wccpf-is-editable-yes"),b.prev().show(),b.remove(),a.doUnMask(),c.preventDefault()}),$(window).on("keydown",function(b){var c=b.keyCode?b.keyCode:b.which,a=$("div.wccpf-cart-edit-wrapper");27===c&&a.length>0&&(a.closest("ul.wccpf-cart-editor-ul").addClass("wccpf-is-editable-yes"),a.prev().show(),a.remove())}),$(document).on("change","[data-is_pricing_rules=yes]",function(a){b.updateNegotiatePrice($(this))}),setTimeout(function(){$('[data-has_field_rules="yes"]').trigger("change"),"archive"!=wccpf_opt.is_page&&b.updateNegotiatePrice()},180),$(document).on("change","input[name=variation_id]",function(){""!=$("input[name=variation_id]").val().trim()?(l("wcff_variation_fields","GET",{variation_id:$("input[name=variation_id]").val()}),m("wcff_variation_fields")):($(".wcff-variation-field").html(""),b.updateNegotiatePrice($(this)))})},this.getFieldForEdit=function(a){var b=0!=a.find(".wcff-color-picker-color-show").length?a.find(".wcff-color-picker-color-show").css("background-color"):$.trim(a.find("p").text()),c={product_id:a.attr("data-productid"),product_cart_id:a.attr("data-itemkey"),data:{value:b,field:a.attr("data-field"),name:a.attr("data-fieldname")}};l("wcff_render_field_on_cart_edit","GET",c),m("inflate_field_for_edit",a)},this.updateNegotiatePrice=function(b){if(b){var a=$(""),d="no",e="yes"==wccpf_opt.cloning?"yes":"no",f="archive"==wccpf_opt.is_page?b.closest("li.product").find("[data-is_pricing_rules=yes]"):$("[data-is_pricing_rules=yes]"),g={"_product_id":"archive"==wccpf_opt.is_page?b.closest("li.product").find("a.add_to_cart_button").attr("data-product_id"):0!=$("input[name=add-to-cart]").length?$("input[name=add-to-cart]").val():$("button[name=add-to-cart]").val(),"_variation_id":$("input[name=variation_id]").val(),"_fields_data":[]},h=0==$("input[name=variation_id]").length||""!=$("input[name=variation_id]").val().trim()&&"0"!=$("input[name=variation_id]").val().trim();if(h){for(var c=0;c<f.length;c++)if((a=$(f[c])).is(":visible")||a.is(".wccpf-color")&&a.closest("table").is(":visible")&&!a.closest("table").is(".wcff_is_hidden_from_field_rule")){d="yes"==e?a.is("[type=radio]")||a.is("[type=checkbox]")?a.closest("ul").data("cloneable"):a.data("cloneable"):e;var i=a.is("[type=checkbox]")?a.attr("name").replace("[","").replace("]",""):a.attr("name"),j=a.is("[type=checkbox]")?a.prop("checked")?[a.val()]:[]:a.is("[type=radio]")?a.is(":checked")?a.val():"":a.val();g._fields_data.push({is_clonable:d,name:i,value:j})}}}},this.updateField=function(a){var b=null,c=new g,e=a.closest("div.wccpf-cart-edit-wrapper").attr("data-field"),f=a.closest("div.wccpf-cart-edit-wrapper").attr("data-field_name"),d=a.closest("div.wccpf-cart-edit-wrapper").attr("data-field_type"),h=a.closest("div.wccpf-cart-edit-wrapper").attr("data-product_id"),i=a.closest("div.wccpf-cart-edit-wrapper").attr("data-item_key");"radio"===d?(c.doValidate(a.closest("div.wccpf-cart-edit-wrapper").find("input")),b=a.closest("div.wccpf-cart-edit-wrapper").find("input:checked").val()):"checkbox"===d?(c.doValidate(a.closest("div.wccpf-cart-edit-wrapper").find("input")),b=a.closest("div.wccpf-cart-edit-wrapper").find("input:checked").map(function(){return this.value}).get()):(c.doValidate(a.closest("div.wccpf-cart-edit-wrapper").find(".wccpf-field")),b=a.closest("div.wccpf-cart-edit-wrapper").find(".wccpf-field").val()),c.isValid&&(l("wcff_update_cart_field_data","PUT",{product_id:h,cart_item_key:i,data:{field:e,name:f,value:b,field_type:d}}),m("update_cart_field_data",a))},this.responseHandler=function(i,a){if(d.status){if("inflate_field_for_edit"===i&&d.payload){var e="",j=$("head"),n=$(d.payload.html).find("td:last"),o='<button data-color_show="'+d.payload.color_showin+'" class="button wccpf-update-cart-field-btn">Update</button>';"file"!==d.payload.field_type&&(e='<div class="wccpf-cart-edit-wrapper wccpf-cart-edit-'+d.payload.field_type+'-wrapper" data-field_type="'+d.payload.field_type+'" data-field="'+a.attr("data-field")+'" data-field_name="'+a.attr("data-fieldname")+'" data-product_id="'+a.attr("data-productid")+'" data-item_key="'+a.attr("data-itemkey")+'">',e+='<a href="#" id="wccpf-cart-editor-close-btn" title="Close Editor"></a>',e+=n.html()+o,e+="<div>",e=$(e),a.hide(),a.parent().append(e)),"email"==d.payload.field_type||"text"==d.payload.field_type||"number"==d.payload.field_type||"textarea"==d.payload.field_type?e.find("input").trigger("focus"):"colorpicker"==d.payload.field_type?j.append(d.payload.script):"datepicker"==d.payload.field_type&&(a.parent().find(".wccpf-field").val(c.payload.data.value),0==j.find("script[data-type=wpff-datepicker-script]").length&&j.append(d.payload.script),j.append($(d.payload.html)[2]))}else if("update_cart_field_data"==i)d.payload.status?("colorpicker"!==d.payload.field_type?a.closest("div.wccpf-cart-edit-wrapper").parent().find("li.wcff_cart_editor_field").show().html("<p>"+decodeURI(d.payload.value)+"</p>"):"yes"===a.closest("div.wccpf-cart-edit-wrapper").parent().find("li.wcff_cart_editor_field").attr("data-color-box")?a.closest("div.wccpf-cart-edit-wrapper").parent().find("li.wcff_cart_editor_field").show().html('<p><span class="wcff-color-picker-color-show" style="background: '+decodeURI(d.payload.value)+';"></span></p>'):a.closest("div.wccpf-cart-edit-wrapper").parent().find("li.wcff_cart_editor_field").show().html("<p>"+decodeURI(d.payload.value)+"</p>"),a.closest("ul.wccpf-cart-editor-ul").addClass("wccpf-is-editable-yes"),a.closest("div.wccpf-cart-edit-wrapper").remove()):a.prev().html(d.payload.message).show();else if("wcff_ajax_get_negotiated_price"==i){var k=void 0===a?$("div.product"):"single"==wccpf_opt.is_page?a.closest("div.product"):a.closest("li.product");if(d.payload.status){var m=k.find(".wcff_pricing_rules_title_container"),f="";"show"==wccpf_opt.ajax_pricing_rules_title.trim()&&0!=d.payload.data.data_title.length&&(f+='<h4 class="wcff_pricing_rules_title_container">'+wccpf_opt.ajax_pricing_rules_title_header.trim()+"</h4>"),f+="<table><tbody>";for(var b=0;b<d.payload.data.data_title.length;b++)f+="<tr><td>"+d.payload.data.data_title[b].title+"</td><td>"+d.payload.data.data_title[b].amount+"</td></tr>";f+="</table></tbody>","show"==wccpf_opt.price_details&&(0!=m.length?(m.html(f),0==d.payload.data.data_title.length?$(".wcff_pricing_rules_title_container").hide():$(".wcff_pricing_rules_title_container").show()):k.find(".wccpf_fields_table:last").parent().after('<div class="wcff_pricing_rules_title_container">'+f+"</div>")),"archive"==wccpf_opt.is_page?k.find("span.price span.amount:last").replaceWith(d.payload.data.amount):"default"==wccpf_opt.ajax_pricing_rules_price_container_is||"both"==wccpf_opt.ajax_pricing_rules_price_container_is?(0!=$(".summary.entry-summary .woocommerce-variation-price:visible").length?$(".summary.entry-summary .woocommerce-variation-price").html(d.payload.data.amount):$(".summary.entry-summary .price .woocommerce-Price-amount").replaceWith(d.payload.data.amount),"both"==wccpf_opt.ajax_pricing_rules_price_container_is&&$(wccpf_opt.ajax_price_replace_container).html(d.payload.data.amount)):$(wccpf_opt.ajax_price_replace_container).html(d.payload.data.amount)}$(".woocommerce-variation-add-to-cart .button, button[name=add-to-cart]").removeClass("disabled")}else if("wcff_variation_fields"==i){var g=$(".wcff-variation-field");if(g.html(""),0!=g.length)for(var h=d.payload.data,b=0;b<h.length;b++)"color_picker_scripts"==h[b].location?$("body").append(h[b].html):$(".wcff-variation-field[data-area='"+h[b].location+"']").append(h[b].html);for(var g=$(".wcff-variation-cloning-field-container"),b=0;b<g.length;b++){var l=$(g[b]);0==l.find(".wcff-variation-field").children().length?l.hide():l.show()}$('[data-has_field_rules="yes"]').trigger("change")}}}};function k(){var a=0,d=0,c={},e=[],b=Object.keys(wcff_color_picker_meta);for(a=0;a<b.length;a++){if(e=[],(c={}).color=wcff_color_picker_meta[b[a]].default_value,c.preferredFormat=wcff_color_picker_meta[b[a]].color_format,wcff_color_picker_meta[b[a]].palettes&&wcff_color_picker_meta[b[a]].palettes.length>0){for(c.showPalette=!0,"yes"==wcff_color_picker_meta[b[a]].show_palette_only&&(c.showPaletteOnly=!0),d=0;d<wcff_color_picker_meta[b[a]].palettes.length;d++)e.push(wcff_color_picker_meta[b[a]].palettes[d].split(","));c.palette=e}"yes"!=wcff_color_picker_meta[b[a]].show_palette_only&&"yes"==wcff_color_picker_meta[b[a]].color_text_field&&(c.showInput=!0),$("input.wccpf-color-"+b[a]).spectrum(c)}}function l(a,b,d,e){c={method:b,context:a,post:e,post_type:"wccpf",payload:d}}function m(e,f,g){b&&$.ajax({type:"POST",data:{action:"wcff_ajax",wcff_param:JSON.stringify(c)},dataType:"json",url:woocommerce_params.ajax_url,beforeSend:function(){b=!1,a&&f&&a.doMask(f)},success:function(a){var c,g,h;b=!0,c=a.status,g=a.message,h=a.data,(d={status:c,message:g,payload:h}).status&&n(e,f)},error:function(a,c,d){b=!0},complete:function(){a.doUnMask()}})}function n(a,b){d.status&&("wcff_variation_fields"===a?function(){var a=0,b=[];if($("div.wccvf-loading-spinner").remove(),$("table.variations select").prop("disabled",!1),$("#wcff-variation-fields").removeClass("loading"),$("input[name=variation_id]").val()){if($("#wcff-variation-fields").html(d.payload.html),d.payload.meta=JSON.parse(d.payload.meta),wcff_date_picker_meta)for(a=0,wcff_date_picker_meta=Array.isArray(wcff_date_picker_meta)?{}:wcff_date_picker_meta,b=Object.keys(d.payload.meta.date_picker_meta);a<b.length;a++)wcff_date_picker_meta[b[a]]=d.payload.meta.date_picker_meta[b[a]];if(wcff_color_picker_meta){for(a=0,wcff_color_picker_meta=Array.isArray(wcff_color_picker_meta)?{}:wcff_color_picker_meta,b=Object.keys(d.payload.meta.color_picker_meta);a<b.length;a++)wcff_color_picker_meta[b[a]]=d.payload.meta.color_picker_meta[b[a]];k()}if(wcff_fields_rules_meta)for(a=0,wcff_fields_rules_meta=Array.isArray(wcff_fields_rules_meta)?{}:wcff_fields_rules_meta,b=Object.keys(d.payload.meta.fields_rules_meta);a<b.length;a++)wcff_fields_rules_meta[b[a]]=d.payload.meta.fields_rules_meta[b[a]];if(wcff_pricing_rules_meta)for(a=0,wcff_pricing_rules_meta=Array.isArray(wcff_pricing_rules_meta)&&0==wcff_pricing_rules_meta.length?{}:wcff_pricing_rules_meta,b=Object.keys(d.payload.meta.pricing_rules_meta);a<b.length;a++)wcff_pricing_rules_meta[b[a]]=d.payload.meta.pricing_rules_meta[b[a]];setTimeout(function(){wcffPricingRulerObj.updatePrice()},200)}}():wcffEditorObj&&wcffEditorObj.responseHandler(a,b))}function o(e,f){for(var b={},a=$(""),c=0;c<e.length;c++)if(0==(a=$(e[c])).closest(".wcff_is_hidden_from_field_rule").length){if(wcffValidatorObj&&"yes"===a.attr("data-mandatory")&&wcffValidatorObj.doValidate(a),a.is("[type=checkbox]")||a.is("[type=radio]")){if(a.is("[type=radio]"))b[a.attr("name")]=f.find('[name="'+a.attr("name")+'"]:checked').val();else if(a.is("[type=checkbox]")&&a.is(":checked")){var d=a.attr("name").replace("[]","");void 0===b[d]&&(b[d]=[]),b[d].push(a.val())}}else b[a.attr("name")]=f.find('[name="'+a.attr("name")+'"]').val()}return b}$(document).on("focus","input.wccpf-datepicker",function(){var k,l,m,b={},a=null,g=[],h=[],d=[],n=null,o=null,p="",c="",i=$(this).attr("data-fkey"),j=new Date;if(wcff_date_picker_meta&&wcff_date_picker_meta[i]){if(a=wcff_date_picker_meta[i],void 0!==$&& void 0!==$.datepicker&&("none"!=a.localize&&"en"!=a.localize?$.datepicker.setDefaults($.extend({},$.datepicker.regional[a.localize])):$.datepicker.setDefaults($.extend({},$.datepicker.regional["en-GB"]))),a.field.timepicker&&"yes"===a.field.timepicker&&(b.controlType="select",b.oneLine=!0,b.timeFormat="hh:mm tt",a.field.min_max_hours_minutes&&""!==a.field.min_max_hours_minutes&&2===(d=a.field.min_max_hours_minutes.split("|")).length&&(""!==d[0]&&2===(g=d[0].split(":")).length&&(b.hourMin=g[0],b.hourMax=g[1]),""!==d[1]&&2===(h=d[1].split(":")).length&&(b.minuteMin=h[0],b.minuteMax=h[1]))),b.dateFormat=a.dateFormat,a.field.display_in_dropdown&&"yes"===a.field.display_in_dropdown&&(b.changeMonth=!0,b.changeYear=!0,b.yearRange=a.year_range),a.field.disable_date&&""!==a.field.disable_date&&("future"===a.field.disable_date&&(b.maxDate=0),"past"===a.field.disable_date&&(b.minDate=new Date)),a.field.disable_next_x_day&&""!=a.field.disable_next_x_day){let e=j.getDay(),f=parseInt(a.field.disable_next_x_day,10);a.field.weekend_weekdays&&"weekends"==a.field.weekend_weekdays&&(6==e||0==e?6==e?f+=2:0==e&&(f+=1):e+f>5&&(f+=2)),b.minDate="+'"+f+"'d"}(a.field.allow_next_x_years&&""!=a.field.allow_next_x_years||a.field.allow_next_x_months&&""!=a.field.allow_next_x_months||a.field.allow_next_x_weeks&&""!=a.field.allow_next_x_weeks||a.field.allow_next_x_days&&""!=a.field.allow_next_x_days)&&(c="",a.field.allow_next_x_years&&""!=a.field.allow_next_x_years&&(c+="+"+a.field.allow_next_x_years.trim()+"y "),a.field.allow_next_x_months&&""!=a.field.allow_next_x_months&&(c+="+"+a.field.allow_next_x_months.trim()+"m "),a.field.allow_next_x_weeks&&""!=a.field.allow_next_x_weeks&&(c+="+"+a.field.allow_next_x_weeks.trim()+"w "),a.field.allow_next_x_days&&""!=a.field.allow_next_x_days&&(c+="+"+a.field.allow_next_x_days.trim()+"d"),b.minDate=0,b.maxDate=c.trim()),b.onSelect=function(a){$(this).trigger("change"),$(this).next().hide()},b.beforeShowDay=function(c){var b=0,d="",g=c.getDay(),e="",f="";if(a.field.disable_days&&a.field.disable_days.length>0){for(g=c.getDay(),e=a.field.disable_days,b=0;b<e.length;b++)if(g==(d="sunday"==(d=e[b])?0:"monday"==d?1:"tuesday"==d?2:"wednesday"==d?3:"thursday"==d?4:"friday"==d?5:"saturday"==d?6:""))return[!1]}if(a.field.specific_date_all_months&&""!=a.field.specific_date_all_months){f=a.field.specific_date_all_months.split(",");for(var b=0;b<f.length;b++)if(parseInt(f[b].trim())==c.getDate())return[!1]}if(a.field.specific_dates&&""!=a.field.specific_dates){p=a.field.specific_dates.split(",");for(var b=0;b<p.length;b++)p[b]=p[b].trim();if(k=c.getMonth(),l=c.getDate(),m=c.getFullYear(),o=k+1+"-"+l+"-"+m,-1!=$.inArray(o,p))return[!1]}if(a.field.disable_next_x_day&&a.field.disable_next_x_day,a.field.weekend_weekdays&&""!=a.field.display_in_dropdown){if("weekdays"==a.field.weekend_weekdays)return[!(n=$.datepicker.noWeekends(c))[0]];if("weekends"==a.field.weekend_weekdays)return $.datepicker.noWeekends(c)}return[!0]}}a.field.timepicker&&"yes"===a.field.timepicker?$(this).datetimepicker(b):$(this).datepicker(b)}),$(document).on("change","input[name=variation_id]",function(){var a=$("input[name=variation_id]").val();""!=a.trim()?$("#wcff-variation-fields").length>0&&($("table.variations select").prop("disabled",!0),$("#wcff-variation-fields").addClass("loading"),$("a.reset_variations").after($('<div class="wccvf-loading-spinner"></div>')),l("wcff_variation_fields","GET",{variation_id:a},""),m("wcff_variation_fields",$("#wcff-variation-fields"))):$("#wcff-variation-fields").html("")}),$(document).on("reset_data",function(){$("#wcff-variation-fields").html("")}),$(document).on("submit","form.cart",function(){if(console.log("on submit called"),$(".wcff_is_hidden_from_field_rule").remove(),void 0!==wccpf_opt.location){var a=$(this);$(".wccpf_fields_table").each(function(){let c=$(this).closest("li.product");if((!c||!(c.length>0))&&0==$(this).closest("form.cart").length){var b=$(this).clone(!0);b.css("display","none"),"select"===$(this).find(".wccpf-field").attr("data-field-type")&&b.find("select.wccpf-field").val($(this).find("select.wccpf-field").val()),a.append(b)}})}}),$(document).ready(function(){if(a=new h,"undefined"!=typeof wccpf_opt&&(void 0!==wccpf_opt.cloning&&"yes"===wccpf_opt.cloning&&new f().init(),void 0!==wccpf_opt.validation&&"yes"===wccpf_opt.validation&&(wcffValidatorObj=new g).init()),(wcffFieldsRulerObj=new e).init(),(wcffPricingRulerObj=new i).init(),0!=$(".single-product").length|| void 0!==wccpf_opt.editable&&"yes"===wccpf_opt.editable||0!=$("[data-is_pricing_rules=yes]").length)(wcffEditorObj=new j).init();else{var b=$("li.wcff_cart_editor_field");b.removeClass("wcff_cart_editor_field").removeAttr("title data-field data-fieldname data-productid data-itemkey"),b.closest(".wccpf-is-editable-yes").removeClass("wccpf-is-editable-yes")}"undefined"==typeof wcff_color_picker_meta||$.isEmptyObject(wcff_color_picker_meta)||k(),l("wcff_variation_fields","GET",{variation_id:0}),m("wcff_variation_fields"),"archive"===wccpf_opt.is_page&&"no"==wccpf_opt.is_ajax_add_to_cart&&$(document).on("click",".add_to_cart_button:not(.product_type_variable)",function(e){var b=$(this).closest("li.product"),c=o(b.find(".wccpf_fields_table:not(.wcff_is_hidden_from_field_rule) .wccpf-field"),b),a="";for(var d in c)a+="&"+d+"="+c[d];""!=a&&$(this).attr("href",$(this).attr("href")+a)}),$(document).on("change",".wccpf-field",function(d){var a=$(this);if(a.is("input[type=file]")&&"yes"===a.attr("data-preview")&& -1!==$.inArray(a.val().split(".").pop().toLowerCase(),["jpeg","jpg","png","gif","bmp"])){a.next().is(".wcff_image_prev_shop_continer")||a.after('<div class="wcff_image_prev_shop_continer" style="width:'+a.attr("data-preview-width")+'"></div>');for(var c="",b=0;b<a[0].files.length;b++)c+='<img class="wcff-prev-shop-image" src="'+URL.createObjectURL(a[0].files[b])+'">',a[0].files[b].name=a[0].files[b].name.replace(/'|$|,/g,""),a[0].files[b].name=a[0].files[b].name.replace("$","");a.next(".wcff_image_prev_shop_continer").html(c)}}),$(document).on("change",".wccpf-color-radio-btn-wrapper input[type=radio]",function(){$(".wccpf-color-radio-btn-wrapper").removeClass("active"),$(".wccpf-color-radio-btn-wrapper").each(function(){$(this).find("input[type=radio]").is(":checked")&&$(this).addClass("active")})}),$(document).on("change",".wccpf-image-radio-btn-wrapper input[type=radio]",function(){$(".wccpf-image-radio-btn-wrapper").removeClass("active"),$(".wccpf-image-radio-btn-wrapper").each(function(){$(this).find("input[type=radio]").is(":checked")&&$(this).addClass("active")})}),$(document).on("change",".wccpf-text-radio-btn-wrapper input[type=radio]",function(){$(".wccpf-text-radio-btn-wrapper").removeClass("active"),$(".wccpf-text-radio-btn-wrapper").each(function(){$(this).find("input[type=radio]").is(":checked")&&$(this).addClass("active")})}),$(document.body).on("adding_to_cart",function(e,b,c){let a=null;if(b&& !b instanceof jQuery&&(b=$(b)),b instanceof jQuery&&((a=b.closest("li.product"))&&0!=a.length||(a=b.closest("form.cart")),a&& !a instanceof jQuery&&(a=$(a)),a&&a.length>0)){let d=o(a.find(".wccpf_fields_table .wccpf-field"),a);$.extend(c,d)}}),setTimeout(function(){"archive"!=wccpf_opt.is_page&&wcffPricingRulerObj.updatePrice()},200)})}(jQuery)